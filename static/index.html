<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notflix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #1a1a1a; color: #fff; }
        .top { display: flex; justify-content: space-between; padding: 10px 20px; background: #111; }
        .logo { font-size: 24px; font-weight: bold; color: #e50914; }
        .search { width: 50%; padding: 5px 10px; background: #333; border: 1px solid #444; border-radius: 5px; color: #fff; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; padding: 20px; }
        .item { position: relative; border-radius: 10px; background: #333; overflow: hidden; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); }
        .item img { width: 100%; height: 300px; object-fit: cover; transition: transform 0.3s; }
        .item img:hover { transform: scale(1.1); }
        .placeholder { background: #555; color: #fff; font-size: 20px; font-weight: bold; text-align: center; padding: 10px; height: 100%; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <div class="top">
        <div class="logo">Notflix</div>
        <input type="text" class="search" id="search" placeholder="Search Movies & TV Shows...">
    </div>
    <div class="grid" id="grid"></div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('grid');
            const search = document.getElementById('search');
            let lol;

            const fetchData = async (url) => {
                try { return await (await fetch(url)).json(); } catch { return { results: [] }; }
            };

            const loadGrid = (data) => {
                grid.innerHTML = data.length ? data.map(i => 
                    <div class="item">
                        <a href="details.html?id=${i.id}&type=${i.media_type === 'movie' ? 1 : 2}">
                            <img src="https://image.tmdb.org/t/p/w500${i.poster_path}" alt="${i.title || i.name}" onerror="this.parentNode.innerHTML='<div class=\'placeholder\'>${i.title || i.name || 'No Title'}</div>'">
                        </a>
                    </div>).join('') : '<div class="placeholder">No results found.</div>';
            };

            const init = async () => loadGrid([
                ...(await fetchData('http://localhost:5000/movie/popular?page=1')).results,
                ...(await fetchData('http://localhost:5000/tv/popular?page=1')).results
            ]);

            search.addEventListener('input', () => {
                clearTimeout(lol);
                lol = setTimeout(async () => {
                    const query = search.value.trim();
                    loadGrid(query ? (await fetchData(http://localhost:5000/search?query=${query})).results : await init());
                }, 500);
            });

            init();
        });
    </script>
</body>
</html>